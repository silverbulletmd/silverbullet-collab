{
  "name": "collab",
  "imports": [
    "https://get.silverbullet.md/global.plug.json"
  ],
  "functions": {
    "detectCollabPage": {
      "events": [
        "editor:pageLoaded",
        "plugs:loaded"
      ],
      "code": "(() => { var mod=(()=>{var v=Object.create;var l=Object.defineProperty;var T=Object.getOwnPropertyDescriptor;var w=Object.getOwnPropertyNames;var M=Object.getPrototypeOf,A=Object.prototype.hasOwnProperty;var F=(e=>typeof require!=\"undefined\"?require:typeof Proxy!=\"undefined\"?new Proxy(e,{get:(r,n)=>(typeof require!=\"undefined\"?require:r)[n]}):e)(function(e){if(typeof require!=\"undefined\")return require.apply(this,arguments);throw new Error('Dynamic require of \"'+e+'\" is not supported')});var u=(e,r)=>{for(var n in r)l(e,n,{get:r[n],enumerable:!0})},d=(e,r,n,i)=>{if(r&&typeof r==\"object\"||typeof r==\"function\")for(let s of w(r))!A.call(e,s)&&s!==n&&l(e,s,{get:()=>r[s],enumerable:!(i=T(r,s))||i.enumerable});return e};var S=(e,r,n)=>(n=e!=null?v(M(e)):{},d(r||!e||!e.__esModule?l(n,\"default\",{value:e,enumerable:!0}):n,e)),k=e=>d(l({},\"__esModule\",{value:!0}),e);var he={};u(he,{default:()=>ye});function g(e,r){if(r(e))return[e];let n=[];if(e.children)for(let i of e.children)n=[...n,...g(i,r)];return n}function x(e,r){return g(e,n=>n.type===r)[0]}function m(e){let r=[];if(e.text!==void 0)return e.text;for(let n of e.children)r.push(m(n));return r.join(\"\")}var c={};u(c,{dispatch:()=>z,enableReadOnlyMode:()=>J,filterBox:()=>B,flashNotification:()=>q,getCurrentPage:()=>U,getCursor:()=>D,getSelection:()=>L,getText:()=>p,hidePanel:()=>V,insertAtCursor:()=>Y,insertAtPos:()=>K,matchBefore:()=>G,moveCursor:()=>j,navigate:()=>$,openUrl:()=>R,prompt:()=>H,reloadPage:()=>N,replaceRange:()=>Q,save:()=>O,setPage:()=>C,setSelection:()=>E,showPanel:()=>I});typeof self>\"u\"&&(self={syscall:()=>{throw new Error(\"Not implemented here\")}});var t=self.syscall;function U(){return t(\"editor.getCurrentPage\")}function C(e){return t(\"editor.setPage\",e)}function p(){return t(\"editor.getText\")}function D(){return t(\"editor.getCursor\")}function L(){return t(\"editor.getSelection\")}function E(e,r){return t(\"editor.setSelection\",e,r)}function O(){return t(\"editor.save\")}function $(e,r,n=!1){return t(\"editor.navigate\",e,r,n)}function N(){return t(\"editor.reloadPage\")}function R(e){return t(\"editor.openUrl\",e)}function q(e,r=\"info\"){return t(\"editor.flashNotification\",e,r)}function B(e,r,n=\"\",i=\"\"){return t(\"editor.filterBox\",e,r,n,i)}function I(e,r,n,i=\"\"){return t(\"editor.showPanel\",e,r,n,i)}function V(e){return t(\"editor.hidePanel\",e)}function K(e,r){return t(\"editor.insertAtPos\",e,r)}function Q(e,r,n){return t(\"editor.replaceRange\",e,r,n)}function j(e){return t(\"editor.moveCursor\",e)}function Y(e){return t(\"editor.insertAtCursor\",e)}function G(e){return t(\"editor.matchBefore\",e)}function z(e){return t(\"editor.dispatch\",e)}function H(e,r=\"\"){return t(\"editor.prompt\",e,r)}function J(e){return t(\"editor.enableReadOnlyMode\",e)}function P(e){return t(\"markdown.parseMarkdown\",e)}var h=S(F(\"https://deno.land/std/encoding/yaml.ts\"));var o=self.syscall;var a={};u(a,{batchDel:()=>ae,batchSet:()=>oe,del:()=>se,deleteAll:()=>ce,deletePrefix:()=>ue,get:()=>ie,queryPrefix:()=>le,set:()=>ne});function ne(e,r){return o(\"store.set\",e,r)}function oe(e){return o(\"store.batchSet\",e)}function ie(e){return o(\"store.get\",e)}function se(e){return o(\"store.delete\",e)}function ae(e){return o(\"store.batchDelete\",e)}function le(e){return o(\"store.queryPrefix\",e)}function ue(e){return o(\"store.deletePrefix\",e)}function ce(){return o(\"store.deleteAll\")}var f={};u(f,{start:()=>ge,stop:()=>xe});function ge(e,r,n){return t(\"collab.start\",e,r,n)}function xe(){return t(\"collab.stop\")}async function Pe(){let e=await a.get(\"shareUsername\");if(!e)if(e=await c.prompt(\"Please enter a publicly visible user name (or cancel for 'anonymous'):\"),e)await a.set(\"shareUsername\",e);else return\"anonymous\";return e}async function b(){let e=await P(await p()),r=x(e,\"FrontMatter\");if(r){let n=m(r.children[1].children[0]),i=h.parse(n);i.$shareServerUrl&&i.$shareToken&&(console.log(\"Going to enable collaboration\"),f.start(i.$shareServerUrl,i.$shareToken,await Pe()))}}var ye=b;return k(he);})();\n return mod;})()"
    },
    "joinCommand": {
      "command": {
        "name": "Collab: Join"
      },
      "code": "(() => { var mod=(()=>{var x=Object.create;var l=Object.defineProperty;var P=Object.getOwnPropertyDescriptor;var y=Object.getOwnPropertyNames;var h=Object.getPrototypeOf,b=Object.prototype.hasOwnProperty;var v=(e=>typeof require!=\"undefined\"?require:typeof Proxy!=\"undefined\"?new Proxy(e,{get:(t,n)=>(typeof require!=\"undefined\"?require:t)[n]}):e)(function(e){if(typeof require!=\"undefined\")return require.apply(this,arguments);throw new Error('Dynamic require of \"'+e+'\" is not supported')});var c=(e,t)=>{for(var n in t)l(e,n,{get:t[n],enumerable:!0})},f=(e,t,n,i)=>{if(t&&typeof t==\"object\"||typeof t==\"function\")for(let a of y(t))!b.call(e,a)&&a!==n&&l(e,a,{get:()=>t[a],enumerable:!(i=P(t,a))||i.enumerable});return e};var T=(e,t,n)=>(n=e!=null?x(h(e)):{},f(t||!e||!e.__esModule?l(n,\"default\",{value:e,enumerable:!0}):n,e)),w=e=>f(l({},\"__esModule\",{value:!0}),e);var ye={};c(ye,{default:()=>Pe});var o={};c(o,{dispatch:()=>K,enableReadOnlyMode:()=>Q,filterBox:()=>O,flashNotification:()=>E,getCurrentPage:()=>M,getCursor:()=>F,getSelection:()=>S,getText:()=>m,hidePanel:()=>N,insertAtCursor:()=>I,insertAtPos:()=>R,matchBefore:()=>V,moveCursor:()=>B,navigate:()=>C,openUrl:()=>L,prompt:()=>j,reloadPage:()=>D,replaceRange:()=>q,save:()=>U,setPage:()=>A,setSelection:()=>k,showPanel:()=>$});typeof self>\"u\"&&(self={syscall:()=>{throw new Error(\"Not implemented here\")}});var r=self.syscall;function M(){return r(\"editor.getCurrentPage\")}function A(e){return r(\"editor.setPage\",e)}function m(){return r(\"editor.getText\")}function F(){return r(\"editor.getCursor\")}function S(){return r(\"editor.getSelection\")}function k(e,t){return r(\"editor.setSelection\",e,t)}function U(){return r(\"editor.save\")}function C(e,t,n=!1){return r(\"editor.navigate\",e,t,n)}function D(){return r(\"editor.reloadPage\")}function L(e){return r(\"editor.openUrl\",e)}function E(e,t=\"info\"){return r(\"editor.flashNotification\",e,t)}function O(e,t,n=\"\",i=\"\"){return r(\"editor.filterBox\",e,t,n,i)}function $(e,t,n,i=\"\"){return r(\"editor.showPanel\",e,t,n,i)}function N(e){return r(\"editor.hidePanel\",e)}function R(e,t){return r(\"editor.insertAtPos\",e,t)}function q(e,t,n){return r(\"editor.replaceRange\",e,t,n)}function B(e){return r(\"editor.moveCursor\",e)}function I(e){return r(\"editor.insertAtCursor\",e)}function V(e){return r(\"editor.matchBefore\",e)}function K(e){return r(\"editor.dispatch\",e)}function j(e,t=\"\"){return r(\"editor.prompt\",e,t)}function Q(e){return r(\"editor.enableReadOnlyMode\",e)}var pe=T(v(\"https://deno.land/std/encoding/yaml.ts\"));var s=self.syscall;var u={};c(u,{deleteAttachment:()=>fe,deletePage:()=>ie,getAttachmentMeta:()=>le,getPageMeta:()=>te,listAttachments:()=>ae,listPages:()=>re,listPlugs:()=>se,readAttachment:()=>ue,readPage:()=>ne,writeAttachment:()=>ce,writePage:()=>oe});function re(e=!1){return r(\"space.listPages\",e)}function te(e){return r(\"space.getPageMeta\",e)}function ne(e){return r(\"space.readPage\",e)}function oe(e,t){return r(\"space.writePage\",e,t)}function ie(e){return r(\"space.deletePage\",e)}function se(){return r(\"space.listPlugs\")}function ae(){return r(\"space.listAttachments\")}function le(e){return r(\"space.getAttachmentMeta\",e)}function ue(e){return r(\"space.readAttachment\",e)}function ce(e,t,n){return r(\"space.writeAttachment\",e,t,n)}function fe(e){return r(\"space.deleteAttachment\",e)}var de=\"wss://collab.silverbullet.md\";function ge(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))}async function g(){let e=await o.prompt(\"Please enter the URL of the server to join:\",de);if(!e)return;let t=await o.prompt(\"Please enter the token:\");if(!t)return;let n=await o.prompt(\"Enter a page name to use to store the page locally:\",\"shared/\"+ge());!n||(await u.writePage(n,xe(e,t)),await o.navigate(n))}function xe(e,t){return`---\n$shareServerUrl: ${e}\n$shareToken: ${t}\n---\n`}var Pe=g;return w(ye);})();\n return mod;})()"
    },
    "shareCommand": {
      "command": {
        "name": "Collab: Share"
      },
      "code": "(() => { var mod=(()=>{var x=Object.create;var u=Object.defineProperty;var P=Object.getOwnPropertyDescriptor;var y=Object.getOwnPropertyNames;var h=Object.getPrototypeOf,b=Object.prototype.hasOwnProperty;var v=(e=>typeof require!=\"undefined\"?require:typeof Proxy!=\"undefined\"?new Proxy(e,{get:(r,n)=>(typeof require!=\"undefined\"?require:r)[n]}):e)(function(e){if(typeof require!=\"undefined\")return require.apply(this,arguments);throw new Error('Dynamic require of \"'+e+'\" is not supported')});var c=(e,r)=>{for(var n in r)u(e,n,{get:r[n],enumerable:!0})},m=(e,r,n,i)=>{if(r&&typeof r==\"object\"||typeof r==\"function\")for(let a of y(r))!b.call(e,a)&&a!==n&&u(e,a,{get:()=>r[a],enumerable:!(i=P(r,a))||i.enumerable});return e};var T=(e,r,n)=>(n=e!=null?x(h(e)):{},m(r||!e||!e.__esModule?u(n,\"default\",{value:e,enumerable:!0}):n,e)),w=e=>m(u({},\"__esModule\",{value:!0}),e);var ye={};c(ye,{default:()=>Pe});var s={};c(s,{dispatch:()=>K,enableReadOnlyMode:()=>j,filterBox:()=>O,flashNotification:()=>E,getCurrentPage:()=>M,getCursor:()=>F,getSelection:()=>S,getText:()=>p,hidePanel:()=>N,insertAtCursor:()=>I,insertAtPos:()=>R,matchBefore:()=>V,moveCursor:()=>B,navigate:()=>C,openUrl:()=>L,prompt:()=>Q,reloadPage:()=>D,replaceRange:()=>q,save:()=>U,setPage:()=>A,setSelection:()=>k,showPanel:()=>$});typeof self>\"u\"&&(self={syscall:()=>{throw new Error(\"Not implemented here\")}});var t=self.syscall;function M(){return t(\"editor.getCurrentPage\")}function A(e){return t(\"editor.setPage\",e)}function p(){return t(\"editor.getText\")}function F(){return t(\"editor.getCursor\")}function S(){return t(\"editor.getSelection\")}function k(e,r){return t(\"editor.setSelection\",e,r)}function U(){return t(\"editor.save\")}function C(e,r,n=!1){return t(\"editor.navigate\",e,r,n)}function D(){return t(\"editor.reloadPage\")}function L(e){return t(\"editor.openUrl\",e)}function E(e,r=\"info\"){return t(\"editor.flashNotification\",e,r)}function O(e,r,n=\"\",i=\"\"){return t(\"editor.filterBox\",e,r,n,i)}function $(e,r,n,i=\"\"){return t(\"editor.showPanel\",e,r,n,i)}function N(e){return t(\"editor.hidePanel\",e)}function R(e,r){return t(\"editor.insertAtPos\",e,r)}function q(e,r,n){return t(\"editor.replaceRange\",e,r,n)}function B(e){return t(\"editor.moveCursor\",e)}function I(e){return t(\"editor.insertAtCursor\",e)}function V(e){return t(\"editor.matchBefore\",e)}function K(e){return t(\"editor.dispatch\",e)}function Q(e,r=\"\"){return t(\"editor.prompt\",e,r)}function j(e){return t(\"editor.enableReadOnlyMode\",e)}var me=T(v(\"https://deno.land/std/encoding/yaml.ts\"));var o=self.syscall;var l={};c(l,{batchDel:()=>te,batchSet:()=>_,del:()=>re,deleteAll:()=>ie,deletePrefix:()=>oe,get:()=>ee,queryPrefix:()=>ne,set:()=>Z});function Z(e,r){return o(\"store.set\",e,r)}function _(e){return o(\"store.batchSet\",e)}function ee(e){return o(\"store.get\",e)}function re(e){return o(\"store.delete\",e)}function te(e){return o(\"store.batchDelete\",e)}function ne(e){return o(\"store.queryPrefix\",e)}function oe(e){return o(\"store.deletePrefix\",e)}function ie(){return o(\"store.deleteAll\")}var f={};c(f,{start:()=>ce,stop:()=>fe});function ce(e,r,n){return t(\"collab.start\",e,r,n)}function fe(){return t(\"collab.stop\")}var pe=\"wss://collab.silverbullet.md\";function de(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))}async function ge(){let e=await l.get(\"shareUsername\");if(!e)if(e=await s.prompt(\"Please enter a publicly visible user name (or cancel for 'anonymous'):\"),e)await l.set(\"shareUsername\",e);else return\"anonymous\";return e}function xe(e,r){return`---\n$shareServerUrl: ${e}\n$shareToken: ${r}\n---\n`}async function g(){let e=await s.prompt(\"Please enter the URL of the server share via:\",pe);if(!e)return;let r=de();await s.dispatch({changes:[{from:0,insert:xe(e,r)}]}),f.start(e,r,await ge())}var Pe=g;return w(ye);})();\n return mod;})()"
    }
  },
  "assets": {}
}